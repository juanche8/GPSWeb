jQuery.fn.searchFilter=function(c,b){function a(a,t,m){this.$=a;this.add=function(b){if(b==null)a.find(".ui-add-last").click();else a.find(".sf:eq("+b+") .ui-add").click();return this};this.del=function(b){if(b==null)a.find(".sf:last .ui-del").click();else a.find(".sf:eq("+b+") .ui-del").click();return this};this.search=function(){a.find(".ui-search").click();return this};this.reset=function(b){if(b===undefined)b=false;a.find(".ui-reset").trigger("click",[b]);return this};this.close=function(){a.find(".ui-closer").click();return this};if(t!=null){function u(){jQuery(this).toggleClass("ui-state-hover");return false}function s(a){jQuery(this).toggleClass("ui-state-active",a.type=="mousedown");return false}function e(a,b){return"<option value='"+a+"'>"+b+"</option>"}function k(a,c,b){return"<select class='"+a+"'"+(b?" style='display:none;'":"")+">"+c+"</select>"}function q(c,d){var b=a.find("tr.sf td.data "+c);b[0]!=null&&d(b)}function p(c,d){var b=a.find("tr.sf td.data "+c);b[0]!=null&&jQuery.each(d,function(){if(this.data!=null)b.bind(this.type,this.data,this.fn);else b.bind(this.type,this.fn)})}var b=jQuery.extend({},jQuery.fn.searchFilter.defaults,m),c=-1,i="";jQuery.each(b.groupOps,function(){i+=e(this.op,this.text)});i="<select name='groupOp'>"+i+"</select>";a.html("").addClass("ui-searchFilter").append("<div class='ui-widget-overlay' style='z-index: -1'>&#160;</div><table class='ui-widget-content ui-corner-all'><thead><tr><td colspan='5' class='ui-widget-header ui-corner-all' style='line-height: 18px;'><div class='ui-closer ui-state-default ui-corner-all ui-helper-clearfix' style='float: right;'><span class='ui-icon ui-icon-close'></span></div>"+b.windowTitle+"</td></tr></thead><tbody><tr class='sf'><td class='fields'></td><td class='ops'></td><td class='data'></td><td><div class='ui-del ui-state-default ui-corner-all'><span class='ui-icon ui-icon-minus'></span></div></td><td><div class='ui-add ui-state-default ui-corner-all'><span class='ui-icon ui-icon-plus'></span></div></td></tr><tr><td colspan='5' class='divider'><hr class='ui-widget-content' style='margin:1px'/></td></tr></tbody><tfoot><tr><td colspan='3'><span class='ui-reset ui-state-default ui-corner-all' style='display: inline-block; float: left;'><span class='ui-icon ui-icon-arrowreturnthick-1-w' style='float: left;'></span><span style='line-height: 18px; padding: 0 7px 0 3px;'>"+b.resetText+"</span></span><span class='ui-search ui-state-default ui-corner-all' style='display: inline-block; float: right;'><span class='ui-icon ui-icon-search' style='float: left;'></span><span style='line-height: 18px; padding: 0 7px 0 3px;'>"+b.searchText+"</span></span><span class='matchText'>"+b.matchText+"</span> "+i+" <span class='rulesText'>"+b.rulesText+"</span></td><td>&#160;</td><td><div class='ui-add-last ui-state-default ui-corner-all'><span class='ui-icon ui-icon-plusthick'></span></div></td></tr></tfoot></table>");var o=a.find("tr.sf"),r=o.find("td.fields"),n=o.find("td.ops"),f=o.find("td.data"),g="";jQuery.each(b.operators,function(){g+=e(this.op,this.text)});g=k("default",g,true);n.append(g);var v="<input type='text' class='default' style='display:none;' />";f.append(v);var h="",j=false,d=false;jQuery.each(t,function(g){var m=g;h+=e(this.itemval,this.text);if(this.ops!=null){j=true;var l="";jQuery.each(this.ops,function(){l+=e(this.op,this.text)});l=k("field"+m,l,true);n.append(l)}if(this.dataUrl!=null){if(g>c)c=g;d=true;var o=this.dataEvents,r=this.dataInit,s=this.buildSelect;jQuery.ajax(jQuery.extend({url:this.dataUrl,complete:function(d){var b;if(s!=null)b=jQuery("<div />").append(s(d));else b=jQuery("<div />").append(d.responseText);b.find("select").addClass("field"+m).hide();f.append(b.html());r&&q(".field"+g,r);o&&p(".field"+g,o);g==c&&a.find("tr.sf td.fields select[name='field']").change()}},b.ajaxSelectOptions))}else if(this.dataValues!=null){d=true;var i="";jQuery.each(this.dataValues,function(){i+=e(this.value,this.text)});i=k("field"+m,i,true);f.append(i)}else if(this.dataEvents!=null||this.dataInit!=null){d=true;var i="<input type='text' class='field"+m+"' />";f.append(i)}this.dataInit!=null&&g!=c&&q(".field"+g,this.dataInit);this.dataEvents!=null&&g!=c&&p(".field"+g,this.dataEvents)});h="<select name='field'>"+h+"</select>";r.append(h);var l=r.find("select[name='field']");if(j)l.change(function(c){var d=c.target.selectedIndex,b=jQuery(c.target).parents("tr.sf").find("td.ops");b.find("select").removeAttr("name").hide();var a=b.find(".field"+d);if(a[0]==null)a=b.find(".default");a.attr("name","op").show();return false});else n.find(".default").attr("name","op").show();if(d)l.change(function(c){var d=c.target.selectedIndex,b=jQuery(c.target).parents("tr.sf").find("td.data");b.find("select,input").removeClass("vdata").hide();var a=b.find(".field"+d);if(a[0]==null)a=b.find(".default");a.show().addClass("vdata");return false});else f.find(".default").show().addClass("vdata");(j||d)&&l.change();a.find(".ui-state-default").hover(u,u).mousedown(s).mouseup(s);a.find(".ui-closer").click(function(){b.onClose(jQuery(a.selector));return false});a.find(".ui-del").click(function(c){var a=jQuery(c.target).parents(".sf");if(a.siblings(".sf").length>0){b.datepickerFix===true&&jQuery.fn.datepicker!==undefined&&a.find(".hasDatepicker").datepicker("destroy");a.remove()}else{a.find("select[name='field']")[0].selectedIndex=0;a.find("select[name='op']")[0].selectedIndex=0;a.find(".data input").val("");a.find(".data select").each(function(){this.selectedIndex=0});a.find("select[name='field']").change(function(a){a.stopPropagation()})}return false});a.find(".ui-add").click(function(f){var c=jQuery(f.target).parents(".sf"),a=c.clone(true).insertAfter(c);a.find(".ui-state-default").removeClass("ui-state-hover ui-state-active");if(b.clone){a.find("select[name='field']")[0].selectedIndex=c.find("select[name='field']")[0].selectedIndex;var e=a.find("select[name='op']")[0]==null;if(!e)a.find("select[name='op']").focus()[0].selectedIndex=c.find("select[name='op']")[0].selectedIndex;var d=a.find("select.vdata");if(d[0]!=null)d[0].selectedIndex=c.find("select.vdata")[0].selectedIndex}else{a.find(".data input").val("");a.find("select[name='field']").focus()}b.datepickerFix===true&&jQuery.fn.datepicker!==undefined&&c.find(".hasDatepicker").each(function(){var b=jQuery.data(this,"datepicker").settings;a.find("#"+this.id).unbind().removeAttr("id").removeClass("hasDatepicker").datepicker(b)});a.find("select[name='field']").change(function(a){a.stopPropagation()});return false});a.find(".ui-search").click(function(){var e=jQuery(a.selector),c,d=e.find("select[name='groupOp'] :selected").val();if(!b.stringResult)c={groupOp:d,rules:[]};else c='{"groupOp":"'+d+'","rules":[';e.find(".sf").each(function(f){var d=jQuery(this).find("select[name='field'] :selected").val(),e=jQuery(this).find("select[name='op'] :selected").val(),a=jQuery(this).find("input.vdata,select.vdata :selected").val();a+="";if(!b.stringResult)c.rules.push({field:d,op:e,data:a});else{a=a.replace(/\\/g,"\\\\").replace(/\"/g,'\\"');if(f>0)c+=",";c+='{"field":"'+d+'",';c+='"op":"'+e+'",';c+='"data":"'+a+'"}'}});if(b.stringResult)c+="]}";b.onSearch(c);return false});a.find(".ui-reset").click(function(e,d){var c=jQuery(a.selector);c.find(".ui-del").click();c.find("select[name='groupOp']")[0].selectedIndex=0;b.onReset(d);return false});a.find(".ui-add-last").click(function(){var d=jQuery(a.selector+" .sf:last"),c=d.clone(true).insertAfter(d);c.find(".ui-state-default").removeClass("ui-state-hover ui-state-active");c.find(".data input").val("");c.find("select[name='field']").focus();b.datepickerFix===true&&jQuery.fn.datepicker!==undefined&&d.find(".hasDatepicker").each(function(){var a=jQuery.data(this,"datepicker").settings;c.find("#"+this.id).unbind().removeAttr("id").removeClass("hasDatepicker").datepicker(a)});c.find("select[name='field']").change(function(a){a.stopPropagation()});return false});this.setGroupOp=function(d){selDOMobj=a.find("select[name='groupOp']")[0];for(var c={},e=selDOMobj.options.length,b=0;b<e;b++)c[selDOMobj.options[b].value]=b;selDOMobj.selectedIndex=c[d];jQuery(selDOMobj).change(function(a){a.stopPropagation()})};this.setFilter=function(o){var b=o.sfref,j=o.filter,g=[],a,c,p,l,k,d={};selDOMobj=b.find("select[name='field']")[0];for(a=0,p=selDOMobj.options.length;a<p;a++){d[selDOMobj.options[a].value]={index:a,ops:{}};g.push(selDOMobj.options[a].value)}for(a=0,k=g.length;a<k;a++){selDOMobj=b.find(".ops > select[class='field"+a+"']")[0];if(selDOMobj)for(c=0,l=selDOMobj.options.length;c<l;c++)d[g[a]].ops[selDOMobj.options[c].value]=c;selDOMobj=b.find(".data > select[class='field"+a+"']")[0];if(selDOMobj){d[g[a]].data={};for(c=0,l=selDOMobj.options.length;c<l;c++)d[g[a]].data[selDOMobj.options[c].value]=c}}var e,h,f,n,i;e=j.field;if(d[e])h=d[e].index;if(h!=null){f=d[e].ops[j.op];if(f===undefined)for(a=0,k=m.operators.length;a<k;a++)if(m.operators[a].op==j.op){f=a;break}n=j.data;if(d[e].data==null)i=-1;else i=d[e].data[n]}if(h!=null&&f!=null&&i!=null){b.find("select[name='field']")[0].selectedIndex=h;b.find("select[name='field']").change();b.find("select[name='op']")[0].selectedIndex=f;b.find("input.vdata").val(n);b=b.find("select.vdata")[0];if(b)b.selectedIndex=i;return true}else return false}}}return new a(this,c,b)};jQuery.fn.searchFilter.version="1.2.9";jQuery.fn.searchFilter.defaults={clone:true,datepickerFix:true,onReset:function(a){alert("Reset Clicked. Data Returned: "+a)},onSearch:function(a){alert("Search Clicked. Data Returned: "+a)},onClose:function(a){a.hide()},groupOps:[{op:"AND",text:"all"},{op:"OR",text:"any"}],operators:[{op:"eq",text:"is equal to"},{op:"ne",text:"is not equal to"},{op:"lt",text:"is less than"},{op:"le",text:"is less or equal to"},{op:"gt",text:"is greater than"},{op:"ge",text:"is greater or equal to"},{op:"in",text:"is in"},{op:"ni",text:"is not in"},{op:"bw",text:"begins with"},{op:"bn",text:"does not begin with"},{op:"ew",text:"ends with"},{op:"en",text:"does not end with"},{op:"cn",text:"contains"},{op:"nc",text:"does not contain"}],matchText:"match",rulesText:"rules",resetText:"Reset",searchText:"Search",stringResult:true,windowTitle:"Search Rules",ajaxSelectOptions:{}};